(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();const Se=BigInt(2**32-1),Fe=BigInt(32);function It(e,t=!1){return t?{h:Number(e&Se),l:Number(e>>Fe&Se)}:{h:Number(e>>Fe&Se)|0,l:Number(e&Se)|0}}function vt(e,t=!1){const n=e.length;let o=new Uint32Array(n),r=new Uint32Array(n);for(let s=0;s<n;s++){const{h:a,l:c}=It(e[s],t);[o[s],r[s]]=[a,c]}return[o,r]}const xt=(e,t,n)=>e<<n|t>>>32-n,Bt=(e,t,n)=>t<<n|e>>>32-n,Kt=(e,t,n)=>t<<n-32|e>>>64-n,$t=(e,t,n)=>e<<n-32|t>>>64-n;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ot(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Pe(e,t=""){if(!Number.isSafeInteger(e)||e<0){const n=t&&`"${t}" `;throw new Error(`${n}expected integer >0, got ${e}`)}}function q(e,t,n=""){const o=Ot(e),r=e?.length,s=t!==void 0;if(!o||s&&r!==t){const a=n&&`"${n}" `,c=s?` of length ${t}`:"",u=o?`length=${r}`:`type=${typeof e}`;throw new Error(a+"expected Uint8Array"+c+", got "+u)}return e}function ze(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Tt(e,t){q(e,void 0,"digestInto() output");const n=t.outputLen;if(e.length<n)throw new Error('"digestInto() output" expected to be of length >='+n)}function He(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function rt(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}const Nt=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Ct(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function Mt(e){for(let t=0;t<e.length;t++)e[t]=Ct(e[t]);return e}const Ve=Nt?e=>e:Mt;function Ht(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function Dt(e,t=""){return typeof e=="string"?Ht(e):q(e,void 0,t)}function st(e,t={}){const n=(r,s)=>e(s).update(r).digest(),o=e(void 0);return n.outputLen=o.outputLen,n.blockLen=o.blockLen,n.create=r=>e(r),Object.assign(n,t),Object.freeze(n)}function qt(e=32){const t=typeof globalThis=="object"?globalThis.crypto:null;if(typeof t?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return t.getRandomValues(new Uint8Array(e))}const Ke=e=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,e])}),Rt=BigInt(0),ye=BigInt(1),_t=BigInt(2),Ft=BigInt(7),Pt=BigInt(256),zt=BigInt(113),ct=[],at=[],it=[];for(let e=0,t=ye,n=1,o=0;e<24;e++){[n,o]=[o,(2*n+3*o)%5],ct.push(2*(5*o+n)),at.push((e+1)*(e+2)/2%64);let r=Rt;for(let s=0;s<7;s++)t=(t<<ye^(t>>Ft)*zt)%Pt,t&_t&&(r^=ye<<(ye<<BigInt(s))-ye);it.push(r)}const lt=vt(it,!0),Vt=lt[0],jt=lt[1],je=(e,t,n)=>n>32?Kt(e,t,n):xt(e,t,n),Qe=(e,t,n)=>n>32?$t(e,t,n):Bt(e,t,n);function Qt(e,t=24){const n=new Uint32Array(10);for(let o=24-t;o<24;o++){for(let a=0;a<10;a++)n[a]=e[a]^e[a+10]^e[a+20]^e[a+30]^e[a+40];for(let a=0;a<10;a+=2){const c=(a+8)%10,u=(a+2)%10,d=n[u],i=n[u+1],m=je(d,i,1)^n[c],b=Qe(d,i,1)^n[c+1];for(let h=0;h<50;h+=10)e[a+h]^=m,e[a+h+1]^=b}let r=e[2],s=e[3];for(let a=0;a<24;a++){const c=at[a],u=je(r,s,c),d=Qe(r,s,c),i=ct[a];r=e[i],s=e[i+1],e[i]=u,e[i+1]=d}for(let a=0;a<50;a+=10){for(let c=0;c<10;c++)n[c]=e[a+c];for(let c=0;c<10;c++)e[a+c]^=~n[(c+2)%10]&n[(c+4)%10]}e[0]^=Vt[o],e[1]^=jt[o]}rt(n)}class Ee{state;pos=0;posOut=0;finished=!1;state32;destroyed=!1;blockLen;suffix;outputLen;enableXOF=!1;rounds;constructor(t,n,o,r=!1,s=24){if(this.blockLen=t,this.suffix=n,this.outputLen=o,this.enableXOF=r,this.rounds=s,Pe(o,"outputLen"),!(0<t&&t<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=He(this.state)}clone(){return this._cloneInto()}keccak(){Ve(this.state32),Qt(this.state32,this.rounds),Ve(this.state32),this.posOut=0,this.pos=0}update(t){ze(this),q(t);const{blockLen:n,state:o}=this,r=t.length;for(let s=0;s<r;){const a=Math.min(n-this.pos,r-s);for(let c=0;c<a;c++)o[this.pos++]^=t[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:n,pos:o,blockLen:r}=this;t[o]^=n,(n&128)!==0&&o===r-1&&this.keccak(),t[r-1]^=128,this.keccak()}writeInto(t){ze(this,!1),q(t),this.finish();const n=this.state,{blockLen:o}=this;for(let r=0,s=t.length;r<s;){this.posOut>=o&&this.keccak();const a=Math.min(o-this.posOut,s-r);t.set(n.subarray(this.posOut,this.posOut+a),r),this.posOut+=a,r+=a}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return Pe(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(Tt(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,rt(this.state)}_cloneInto(t){const{blockLen:n,suffix:o,outputLen:r,rounds:s,enableXOF:a}=this;return t||=new Ee(n,o,r,a,s),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=s,t.suffix=o,t.outputLen=r,t.enableXOF=a,t.destroyed=this.destroyed,t}}const ut=(e,t,n,o={})=>st(()=>new Ee(t,e,n),o),Gt=ut(6,136,32,Ke(8)),dt=ut(6,72,64,Ke(10)),ft=(e,t,n,o={})=>st((r={})=>new Ee(t,e,r.dkLen===void 0?n:r.dkLen,!0),o),Jt=ft(31,168,16,Ke(11)),ht=ft(31,136,32,Ke(12));function De(e){if(!Number.isSafeInteger(e)||e<0||e>4294967295)throw new Error("wrong u32 integer:"+e);return e}function pt(e){return De(e),(e&e-1)===0&&e!==0}function yt(e,t){De(e);let n=0;for(let o=0;o<t;o++,e>>>=1)n=n<<1|e&1;return n}function gt(e){return De(e),31-Math.clz32(e)}function Ge(e){const t=e.length;if(t<2||!pt(t))throw new Error("n must be a power of 2 and greater than 1. Got "+t);const n=gt(t);for(let o=0;o<t;o++){const r=yt(o,n);if(o<r){const s=e[o];e[o]=e[r],e[r]=s}}return e}const Je=(e,t)=>{const{N:n,roots:o,dit:r,invertButterflies:s=!1,skipStages:a=0,brp:c=!0}=t,u=gt(n);if(!pt(n))throw new Error("FFT: Polynomial size should be power of two");const d=r!==s;return i=>{if(i.length!==n)throw new Error("FFT: wrong Polynomial length");r&&c&&Ge(i);for(let m=0,b=1;m<u-a;m++){const h=r?m+1+a:u-m,S=1<<h,U=S>>1,v=n>>h;for(let y=0;y<n;y+=S)for(let p=0,E=b++;p<U;p++){const B=s?r?n-E:E:p*v,l=y+p,f=y+p+U,w=o[B],k=i[f],A=i[l];if(d){const K=e.mul(k,w);i[l]=e.add(A,K),i[f]=e.sub(A,K)}else s?(i[l]=e.add(k,A),i[f]=e.mul(e.sub(k,A),w)):(i[l]=e.add(A,k),i[f]=e.mul(e.sub(A,k),w))}}return!r&&c&&Ge(i),i}};/*! noble-post-quantum - MIT License (c) 2024 Paul Miller (paulmillr.com) */const Xe=qt;function Oe(e,t){if(e.length!==t.length)return!1;let n=0;for(let o=0;o<e.length;o++)n|=e[o]^t[o];return n===0}function Xt(e){return Uint8Array.from(e)}function ve(e,...t){const n=r=>typeof r=="number"?r:r.bytesLen,o=t.reduce((r,s)=>r+n(s),0);return{bytesLen:o,encode:r=>{const s=new Uint8Array(o);for(let a=0,c=0;a<t.length;a++){const u=t[a],d=n(u),i=typeof u=="number"?r[a]:u.encode(r[a]);q(i,d,e),s.set(i,c),typeof u!="number"&&i.fill(0),c+=d}return s},decode:r=>{q(r,o,e);const s=[];for(const a of t){const c=n(a),u=r.subarray(0,c);s.push(typeof a=="number"?u:a.decode(u)),r=r.subarray(c)}return s}}}function Te(e,t){const n=t*e.bytesLen;return{bytesLen:n,encode:o=>{if(o.length!==t)throw new Error(`vecCoder.encode: wrong length=${o.length}. Expected: ${t}`);const r=new Uint8Array(n);for(let s=0,a=0;s<o.length;s++){const c=e.encode(o[s]);r.set(c,a),c.fill(0),a+=c.length}return r},decode:o=>{q(o,n);const r=[];for(let s=0;s<o.length;s+=e.bytesLen)r.push(e.decode(o.subarray(s,s+e.bytesLen)));return r}}}function Y(...e){for(const t of e)if(Array.isArray(t))for(const n of t)n.fill(0);else t.fill(0)}function We(e){return(1<<e)-1}/*! noble-post-quantum - MIT License (c) 2024 Paul Miller (paulmillr.com) */const Wt=e=>{const{newPoly:t,N:n,Q:o,F:r,ROOT_OF_UNITY:s,brvBits:a}=e,c=(y,p=o)=>{const E=y%p|0;return(E>=0?E|0:p+E|0)|0},u=(y,p=o)=>{const E=c(y,p)|0;return(E>p>>1?E-p|0:E)|0};function d(){const y=t(n);for(let p=0;p<n;p++){const E=yt(p,a),B=BigInt(s)**BigInt(E)%BigInt(o);y[p]=Number(B)|0}return y}const i=d(),m={add:(y,p)=>c((y|0)+(p|0))|0,sub:(y,p)=>c((y|0)-(p|0))|0,mul:(y,p)=>c((y|0)*(p|0))|0,inv:y=>{throw new Error("not implemented")}},b={N:n,roots:i,invertButterflies:!0,skipStages:1,brp:!1},h=Je(m,{dit:!1,...b}),S=Je(m,{dit:!0,...b});return{mod:c,smod:u,nttZetas:i,NTT:{encode:y=>h(y),decode:y=>{S(y);for(let p=0;p<y.length;p++)y[p]=c(r*y[p]);return y}},bitsCoder:(y,p)=>{const E=We(y),B=y*(n/8);return{bytesLen:B,encode:l=>{const f=new Uint8Array(B);for(let w=0,k=0,A=0,K=0;w<l.length;w++)for(k|=(p.encode(l[w])&E)<<A,A+=y;A>=8;A-=8,k>>=8)f[K++]=k&We(A);return f},decode:l=>{const f=t(n);for(let w=0,k=0,A=0,K=0;w<l.length;w++)for(k|=l[w]<<A,A+=8;A>=y;A-=y,k>>=y)f[K++]=p.decode(k&E);return f}}}}},Zt=e=>(t,n)=>{n||(n=e.blockLen);const o=new Uint8Array(t.length+2);o.set(t);const r=t.length,s=new Uint8Array(n);let a=e.create({}),c=0,u=0;return{stats:()=>({calls:c,xofs:u}),get:(d,i)=>(o[r+0]=d,o[r+1]=i,a.destroy(),a=e.create({}).update(o),c++,()=>(u++,a.xofInto(s))),clean:()=>{a.destroy(),Y(s,o)}}},Yt=Zt(Jt);/*! noble-post-quantum - MIT License (c) 2024 Paul Miller (paulmillr.com) */const F=256,ue=3329,en=3303,tn=17,{mod:Ae,nttZetas:nn,NTT:ie,bitsCoder:on}=Wt({N:F,Q:ue,F:en,ROOT_OF_UNITY:tn,newPoly:e=>new Uint16Array(e),brvBits:7}),rn={1024:{N:F,Q:ue,K:4,ETA1:2,ETA2:2,du:11,dv:5,RBGstrength:256}},sn=e=>{if(e>=12)return{encode:n=>n,decode:n=>n};const t=2**(e-1);return{encode:n=>((n<<e)+ue/2)/ue,decode:n=>n*ue+t>>>e}},ge=e=>on(e,sn(e));function le(e,t){for(let n=0;n<F;n++)e[n]=Ae(e[n]+t[n])}function cn(e,t){for(let n=0;n<F;n++)e[n]=Ae(e[n]-t[n])}function an(e,t,n,o,r){const s=Ae(t*o*r+e*n),a=Ae(e*o+t*n);return{c0:s,c1:a}}function Ue(e,t){for(let n=0;n<F/2;n++){let o=nn[64+(n>>1)];n&1&&(o=-o);const{c0:r,c1:s}=an(e[2*n+0],e[2*n+1],t[2*n+0],t[2*n+1],o);e[2*n+0]=r,e[2*n+1]=s}return e}function Ze(e){const t=new Uint16Array(F);for(let n=0;n<F;){const o=e();if(o.length%3)throw new Error("SampleNTT: unaligned block");for(let r=0;n<F&&r+3<=o.length;r+=3){const s=(o[r+0]>>0|o[r+1]<<8)&4095,a=(o[r+1]>>4|o[r+2]<<4)&4095;s<ue&&(t[n++]=s),n<F&&a<ue&&(t[n++]=a)}}return t}function me(e,t,n,o){const r=e(o*F/4,t,n),s=new Uint16Array(F),a=He(r);let c=0;for(let u=0,d=0,i=0,m=0;u<a.length;u++){let b=a[u];for(let h=0;h<32;h++)i+=b&1,b>>=1,c+=1,c===o?(m=i,i=0):c===2*o&&(s[d++]=Ae(m-i),i=0,c=0)}if(c)throw new Error(`sampleCBD: leftover bits: ${c}`);return s}const ln=e=>{const{K:t,PRF:n,XOF:o,HASH512:r,ETA1:s,ETA2:a,du:c,dv:u}=e,d=ge(1),i=ge(u),m=ge(c),b=ve("publicKey",Te(ge(12),t),32),h=Te(ge(12),t),S=ve("ciphertext",Te(m,t),i),U=ve("seed",32,32);return{secretCoder:h,lengths:{secretKey:h.bytesLen,publicKey:b.bytesLen,cipherText:S.bytesLen},keygen:v=>{q(v,32,"seed");const y=new Uint8Array(33);y.set(v),y[32]=t;const p=r(y),[E,B]=U.decode(p),l=[],f=[];for(let A=0;A<t;A++)l.push(ie.encode(me(n,B,A,s)));const w=o(E);for(let A=0;A<t;A++){const K=ie.encode(me(n,B,t+A,s));for(let x=0;x<t;x++){const T=Ze(w.get(x,A));le(K,Ue(T,l[x]))}f.push(K)}w.clean();const k={publicKey:b.encode([f,E]),secretKey:h.encode(l)};return Y(E,B,l,f,y,p),k},encrypt:(v,y,p)=>{const[E,B]=b.decode(v),l=[];for(let x=0;x<t;x++)l.push(ie.encode(me(n,p,x,s)));const f=o(B),w=new Uint16Array(F),k=[];for(let x=0;x<t;x++){const T=me(n,p,t+x,a),H=new Uint16Array(F);for(let R=0;R<t;R++){const _=Ze(f.get(x,R));le(H,Ue(_,l[R]))}le(T,ie.decode(H)),k.push(T),le(w,Ue(E[x],l[x])),Y(H)}f.clean();const A=me(n,p,2*t,a);le(A,ie.decode(w));const K=d.decode(y);return le(K,A),Y(E,l,w,A),S.encode([k,K])},decrypt:(v,y)=>{const[p,E]=S.decode(v),B=h.decode(y),l=new Uint16Array(F);for(let f=0;f<t;f++)le(l,Ue(B[f],ie.encode(p[f])));return cn(E,ie.decode(l)),Y(l,B,p),d.encode(E)}}};function un(e){const t=ln(e),{HASH256:n,HASH512:o,KDF:r}=e,{secretCoder:s,lengths:a}=t,c=ve("secretKey",a.secretKey,a.publicKey,32,32),u=32,d=64;return{info:{type:"ml-kem"},lengths:{...a,seed:64,msg:u,msgRand:u,secretKey:c.bytesLen},keygen:(i=Xe(d))=>{q(i,d,"seed");const{publicKey:m,secretKey:b}=t.keygen(i.subarray(0,32)),h=n(m),S=c.encode([b,m,h,i.subarray(32)]);return Y(b,h),{publicKey:m,secretKey:S}},getPublicKey:i=>{const[m,b,h,S]=c.decode(i);return Uint8Array.from(b)},encapsulate:(i,m=Xe(u))=>{q(i,a.publicKey,"publicKey"),q(m,u,"message");const b=i.subarray(0,384*e.K),h=s.encode(s.decode(Xt(b)));if(!Oe(h,b))throw Y(h),new Error("ML-KEM.encapsulate: wrong publicKey modulus");Y(h);const S=o.create().update(m).update(n(i)).digest(),U=t.encrypt(i,m,S.subarray(32,64));return Y(S.subarray(32)),{cipherText:U,sharedSecret:S.subarray(0,32)}},decapsulate:(i,m)=>{q(m,c.bytesLen,"secretKey"),q(i,a.cipherText,"cipherText");const b=c.bytesLen-96,h=b+32,S=n(m.subarray(b/2,h));if(!Oe(S,m.subarray(h,h+32)))throw new Error("invalid secretKey: hash check failed");const[U,v,y,p]=c.decode(m),E=t.decrypt(i,U),B=o.create().update(E).update(y).digest(),l=B.subarray(0,32),f=t.encrypt(v,E,B.subarray(32,64)),w=Oe(i,f),k=r.create({dkLen:32}).update(p).update(i).digest();return Y(E,f,w?k:l),w?l:k}}}function dn(e,t,n){return ht.create({dkLen:e}).update(t).update(new Uint8Array([n])).digest()}const fn={HASH256:Gt,HASH512:dt,KDF:ht,XOF:Yt,PRF:dn},qe=un({...fn,...rn[1024]}),ne=BigInt(8),Be=BigInt(255);function ke(e){e=BigInt(e);const t=[Number(e&Be)];for(e>>=ne;e>0;e>>=ne)t.unshift(Number(e&Be));return t.unshift(t.length),new Uint8Array(t)}function hn(e){e=BigInt(e);const t=[Number(e&Be)];for(e>>=ne;e>0;e>>=ne)t.unshift(Number(e&Be));return t.push(t.length),new Uint8Array(t)}function pn(e,t){return e.dkLen===void 0?t:e.dkLen}const yn=(e,t="")=>e===void 0?wt:(q(e,void 0,t),e),mt=(e,t)=>new Uint8Array((t-e%t)%t);function gn(e,t={}){if(!t||t.personalization===void 0&&t.NISTfn===void 0)return e;const n=ke(e.blockLen),o=t.NISTfn===void 0?wt:Dt(t.NISTfn),r=ke(ne*BigInt(o.length)),s=yn(t.personalization,"personalization"),a=ke(ne*BigInt(s.length));if(!o.length&&!s.length)return e;e.suffix=4,e.update(n).update(r).update(o).update(a).update(s);let c=n.length+r.length+o.length+a.length+s.length;return e.update(mt(c,e.blockLen)),e}class mn extends Ee{constructor(t,n,o,r,s={}){super(t,31,n,o),gn(this,{NISTfn:"KMAC",personalization:s.personalization}),q(r,void 0,"key");const a=ke(this.blockLen),c=ke(ne*BigInt(r.length));this.update(a).update(c).update(r);const u=a.length+c.length+r.length;this.update(mt(u,this.blockLen))}finish(){this.finished||this.update(hn(this.enableXOF?0:ne*BigInt(this.outputLen))),super.finish()}_cloneInto(t){return t||(t=Object.create(Object.getPrototypeOf(this),{}),t.state=this.state.slice(),t.blockLen=this.blockLen,t.state32=He(t.state)),super._cloneInto(t)}clone(){return this._cloneInto()}}function wn(e,t,n=!1){const o=(r,s,a)=>o.create(r,a).update(s).digest();return o.create=(r,s={})=>new mn(e,pn(s,t),n,r,s),o}const xe=wn(136,32),wt=Uint8Array.of(),G=new TextEncoder().encode("QVv1"),bt="QuantumVault v1.3.0",bn=38,te=8*1024*1024,kn=e=>Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("");function Ce(e){if(e instanceof Uint8Array)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("Expected ArrayBuffer or Uint8Array")}async function z(e){return kn(dt(e))}async function An(){return qe.keygen()}async function kt(e,t,n,o){const r=new Uint8Array(t.length+n.length);r.set(t,0),r.set(n,t.length);const c=xe(e,r,32,{customization:o||bt}),u=xe(c,new Uint8Array([1]),32,{customization:"quantum-vault:kenc:v1"}),d=xe(c,new Uint8Array([2]),32,{customization:"quantum-vault:kiv:v1"}),i=await crypto.subtle.importKey("raw",u.buffer,{name:"AES-GCM"},!1,["encrypt","decrypt"]);return{Kraw:c,Kenc:u,Kiv:d,aesKey:i}}function At(e,t,n){const o=new Uint8Array(e.length+8);o.set(e,0);const r=new DataView(o.buffer);return r.setUint32(o.length-8,t,!1),r.setUint32(o.length-4,n,!1),o}function Et(e,t,n,o){const r=new Uint8Array(4);new DataView(r.buffer).setUint32(0,n,!1);const s=new Uint8Array(t.length+r.length);return s.set(t,0),s.set(r,t.length),xe(e,s,16,{customization:o||"quantum-vault:iv:v1"}).slice(0,12)}function En(e){const t=e.cipherText||e.ciphertext||e.ct,n=e.sharedSecret||e.ss;if(!t||!n)throw new Error("KEM encapsulation failed: result is missing required fields.");return{encapsulatedKey:Ce(t),sharedSecret:Ce(n)}}async function Ln(e,t){const{encapsulatedKey:n,sharedSecret:o}=En(await qe.encapsulate(t)),r=crypto.getRandomValues(new Uint8Array(12)),s=crypto.getRandomValues(new Uint8Array(16)),a=e.length>te,c={kdf:"quantum-vault:kdf:v1",iv:"quantum-vault:chunk-iv:v1"},u={KEM:"ML-KEM-1024",KDF:"KMAC256",AEAD:"AES-256-GCM",aead_mode:a?"per-chunk-aead":"single-container-aead",iv_strategy:a?"kmac-derive-v1":"single-iv",fmt:"QVv1-3-0",timestamp:new Date().toISOString(),fileHash:await z(e),originalLength:e.length,chunkSize:te,chunkCount:a?Math.ceil(e.length/te):1,domainStrings:c},d=new TextEncoder().encode(JSON.stringify(u)),i=new Uint8Array(2);new DataView(i.buffer).setUint16(0,d.length,!1);const m=new Uint8Array(4);new DataView(m.buffer).setUint32(0,n.length,!1);const b=new Uint8Array(G.length+m.length+n.length+r.length+s.length+i.length+d.length);let h=0;b.set(G,h),h+=G.length,b.set(m,h),h+=m.length,b.set(n,h),h+=n.length,b.set(r,h),h+=r.length,b.set(s,h),h+=s.length,b.set(i,h),h+=i.length,b.set(d,h);const{Kraw:S,Kenc:U,Kiv:v,aesKey:y}=await kt(o,s,d,c.kdf);let p;try{if(!a){const k=await crypto.subtle.encrypt({name:"AES-GCM",iv:r,additionalData:b},y,e);return p=new Blob([b,new Uint8Array(k)],{type:"application/octet-stream"}),p}const E=[];let B=0,l=0;for(;B<e.length;){const k=Math.min(te,e.length-B),A=e.subarray(B,B+k),K=Et(v,r,l,c.iv),x=At(b,l,k),T=await crypto.subtle.encrypt({name:"AES-GCM",iv:K,additionalData:x,tagLength:128},y,A);E.push(new Uint8Array(T)),A.fill(0),l++,B+=k}const f=E.reduce((k,A)=>k+A.length,0),w=new Uint8Array(f);{let k=0;for(const A of E)w.set(A,k),k+=A.length}return p=new Blob([b,w],{type:"application/octet-stream"}),p}finally{o.fill(0),S.fill(0),U.fill(0),v.fill(0)}}async function Sn(e,t){if(e.length<bn)throw new Error(`File is too small to be a valid container (size: ${e.length} B).`);const n=new DataView(e.buffer,e.byteOffset);let o=0;const r=e.subarray(o,o+G.length);if(new TextDecoder().decode(r)!==new TextDecoder().decode(G))throw new Error("Invalid file format (magic bytes mismatch).");o+=G.length;const s=n.getUint32(o,!1);o+=4;const a=e.subarray(o,o+s);o+=s;const c=e.subarray(o,o+12);o+=12;const u=e.subarray(o,o+16);o+=16;const d=n.getUint16(o,!1);if(o+=2,d<=0||d>4096)throw new Error(`Invalid metadata length: ${d}. Must be between 1 and 4096.`);if(o+d>e.length)throw new Error("Incomplete container: metadata length exceeds file size.");const i=e.subarray(o,o+d),m=JSON.parse(new TextDecoder().decode(i));o+=d;const b=e.subarray(0,o),h=e.subarray(o),S=await qe.decapsulate(a,t),U=Ce(S);if(!U||U.length===0)throw new Error("KEM decapsulation failed. The key may be incorrect or the ciphertext corrupted.");const v=m.domainStrings||m.domain||{},{Kraw:y,Kenc:p,Kiv:E,aesKey:B}=await kt(U,u,i,v.kdf||bt);if(m.aead_mode==="per-chunk-aead"||m.aead_mode==="per-chunk"){const f=m.chunkCount||Math.ceil(m.originalLength/(m.chunkSize||te)),w=[];let k=0;for(let x=0;x<f;x++){const T=Math.min(te,m.originalLength-x*te),H=T+16,R=h.subarray(k,k+H),_=Et(E,c,x,v.iv||"quantum-vault:chunk-iv:v1"),V=At(b,x,T),P=await crypto.subtle.decrypt({name:"AES-GCM",iv:_,additionalData:V},B,R);w.push(new Uint8Array(P)),k+=H}const A=w.reduce((x,T)=>x+T.length,0),K=new Uint8Array(A);{let x=0;for(const T of w)K.set(T,x),x+=T.length}return U.fill(0),y.fill(0),p.fill(0),E.fill(0),{decryptedBlob:new Blob([K]),metadata:m}}const l=await crypto.subtle.decrypt({name:"AES-GCM",iv:c,additionalData:b},B,h);return U.fill(0),y.fill(0),p.fill(0),E.fill(0),{decryptedBlob:new Blob([l]),metadata:m}}function Un(){const e=document.querySelectorAll("button"),t=l=>document.getElementById(l),n=t("privKeyInput"),o=t("pubKeyInput"),r=t("dataFileInput");t("qencForQcontInput"),t("privKeyForQcontInput");const s=t("rsN"),a=t("rsK"),c=t("rsText"),u=t("rsSegData"),d=t("rsSegParity"),i=t("rsMarker");t("buildQcontBtn"),t("qcontShardsInput"),t("restoreQcontBtn");const m=t("genKeyBtn"),b=t("encBtn"),h=t("decBtn"),S=t("log");function U(l){const f=document.createElement("span");f.textContent=`[${new Date().toLocaleTimeString()}] ${l}`,S.appendChild(f),S.appendChild(document.createTextNode(`
`)),S.scrollTop=S.scrollHeight}function v(l){const f=l&&l.message?l.message:typeof l=="string"?l:String(l),w=document.createElement("span");w.className="error",w.textContent=`[${new Date().toLocaleTimeString()}] ERROR: ${f}`,S.appendChild(w),S.appendChild(document.createTextNode(`
`)),S.scrollTop=S.scrollHeight}function y(l){e.forEach(f=>f.disabled=l)}async function p(l){return new Uint8Array(await l.arrayBuffer())}function E(l,f){const w=document.createElement("a");w.href=URL.createObjectURL(l),w.download=f,w.style.display="none",document.body.appendChild(w),w.click(),URL.revokeObjectURL(w.href),w.remove()}function B(){if(!s||!a)return;let l=parseInt(s.value,10);Number.isNaN(l)&&(l=0);let f=parseInt(a.value,10);Number.isNaN(f)&&(f=0),l<0&&(l=0),f<0&&(f=0),f>=l&&(l=f+1);const w=l-f,k=w%2===0,A=k?w/2:Math.floor(w/2),K=f+A;if(c){const j=k?"":" (adjust n or k so that n − k is even)",O=l===4&&f===2?" WARNING: configuration n=4,k=2 is known to be unstable. Use n≥5 (e.g., n=5,k=3).":"";c.textContent=`Total: n=${l}. Data: k=${f}. Parity: m=${w}. Threshold: t=${K}. Need ≥ t shards to restore.${j}${O}`}const x=l?f/l*100:0,T=l?w/l*100:0,H=l?K/l*100:0;u&&(u.style.width=`${Math.max(0,Math.min(100,x))}%`),d&&(d.style.width=`${Math.max(0,Math.min(100,T))}%`),i&&(i.style.left=`${Math.max(0,Math.min(100,H))}%`);const R=document.getElementById("rsDataLabel"),_=document.getElementById("rsParityLabel"),V=document.getElementById("rsMarkerLabel");R&&(R.textContent=`k=${f} (${Math.round(f/Math.max(1,l)*100)}%)`),_&&(_.textContent=`m=${w} (${Math.round(w/Math.max(1,l)*100)}%)`),V&&(V.textContent=`t=${K}`,V.style.left=`${Math.max(0,Math.min(100,H))}%`);const P=document.getElementById("rsTicks");if(P&&(P.innerHTML="",l>0))for(let j=0;j<=l;j++){const O=document.createElement("span");O.className="tick",O.style.left=`${j/l*100}%`,O.title=String(j),P.appendChild(O)}const X=u&&u.parentElement?u.parentElement:null;X&&X.classList&&X.classList.toggle("rs-error",!k)}[s,a].forEach(l=>l&&l.addEventListener("input",B)),document.addEventListener("DOMContentLoaded",B),B(),m?.addEventListener("click",async()=>{y(!0);try{U("Generating ML-KEM Kyber 1024 key pair...");const{secretKey:l,publicKey:f}=await An(),w=await z(l),k=await z(f);U(`Private Key: secretKey.qkey (${l.length} B) SHA3-512=${w}`),U(`Public Key: publicKey.qkey (${f.length} B) SHA3-512=${k}`),E(new Blob([l]),"secretKey.qkey"),E(new Blob([f]),"publicKey.qkey"),U("✅ Keys generated and downloaded successfully.")}catch(l){v(l)}finally{y(!1)}}),b?.addEventListener("click",async()=>{if(!o?.files?.[0]){v("Please select a public key (.qkey).");return}if(!r?.files?.length){v("Please select file(s) to encrypt.");return}y(!0);try{const l=await p(o.files[0]);for(const f of r.files){U(`Encrypting file ${f.name} (${f.size} B)...`);const w=await p(f),k=await Ln(w,l),A=await p(k),K=await z(A);E(k,`${f.name}.qenc`),U(`✅ File encrypted: ${f.name}.qenc (${k.size} B) SHA3-512=${K}`)}}catch(l){v(l)}finally{y(!1),r.value=""}}),h?.addEventListener("click",async()=>{if(!n?.files?.[0]){v("Please select a private key (.qkey).");return}if(!r?.files?.length){v("Please select file(s) to decrypt (.qenc).");return}y(!0);try{const l=await p(n.files[0]);for(const f of r.files){if(!f.name.toLowerCase().endsWith(".qenc")){U(`Skipping file ${f.name} as it is not a .qenc container.`);continue}U(`Decrypting file ${f.name} (${f.size} B)...`);const w=await p(f),k=await z(w);U(`Container hash: SHA3-512=${k}`);const{decryptedBlob:A,metadata:K}=await Sn(w,l),x=await p(A),T=await z(x),H=f.name.replace(/\.qenc$/i,"");E(A,H),U(`✅ File decrypted: ${H} (${A.size} B)`),U(`Original file hash (from metadata): ${K.fileHash}`),U(`Hash of decrypted content: ${T}`),K.fileHash===T?U("Hashes match! File integrity verified."):v("WARNING: Hashes do NOT match! File may have been corrupted."),U(`Encrypted on (UTC): ${K.timestamp}`)}}catch(l){v(l)}finally{y(!1),r.value=""}})}const In="modulepreload",vn=function(e){return"/quantum-vault/"+e},Ye={},Lt=function(t,n,o){let r=Promise.resolve();if(n&&n.length>0){let d=function(i){return Promise.all(i.map(m=>Promise.resolve(m).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};var a=d;document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),u=c?.nonce||c?.getAttribute("nonce");r=d(n.map(i=>{if(i=vn(i),i in Ye)return;Ye[i]=!0;const m=i.endsWith(".css"),b=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${b}`))return;const h=document.createElement("link");if(h.rel=m?"stylesheet":In,m||(h.as="script"),h.crossOrigin="",h.href=i,u&&h.setAttribute("nonce",u),document.head.appendChild(h),m)return new Promise((S,U)=>{h.addEventListener("load",S),h.addEventListener("error",()=>U(new Error(`Unable to preload CSS for ${i}`)))})}))}function s(c){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=c,window.dispatchEvent(u),!u.defaultPrevented)throw c}return r.then(c=>{for(const u of c||[])u.status==="rejected"&&s(u.reason);return t().catch(s)})};async function Me(e){const t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(n=>n.toString(16).padStart(2,"0")).join("")}function xn(e,t){const n=[],o=[];function r(s,a){if(a===t){n.push(o.slice());return}for(let c=s;c<e.length;c++)o.push(e[c]),r(c+1,a+1),o.pop()}return r(0,0),n}async function Bn(e,t,n){const o=t+n,r=window.erasure.split(e,t,n/2);console.log("SMOKE: split returned",r.length,"fragments, lens=",r.map(c=>c.length));const s=r.map((c,u)=>u),a=xn(s,t);for(const c of a){const u=new Array(o);for(let d=0;d<o;d++)u[d]=new Uint8Array(r[0].length);for(const d of c)u[d]=r[d];try{const d=window.erasure.recombine(u,e.length,t,n/2),i=d.length===e.length&&await Me(d)===await Me(e);console.log("SMOKE combo",c,"-> OK?",i)}catch(d){console.error("SMOKE combo",c,"-> FAIL",String(d))}}}function Kn(e,t){return e===4&&t===2?(alert("Warning: configuration n=4, k=2 is known to be unstable with this erasure library (edge-case decoding errors). Please choose n≥5 (recommended n=5,k=3 for balance, or n=6,k=2 for accessibility)."),!1):!0}function Ne(e){const t=document.getElementById("log");t&&(t.textContent+=`[${new Date().toLocaleTimeString()}] ${e}
`,t.scrollTop=t.scrollHeight)}function Ie(e){const t=document.getElementById("log");if(!t)return;const n=e&&e.message?e.message:typeof e=="string"?e:String(e),o=document.createElement("span");o.className="error",o.textContent=`[${new Date().toLocaleTimeString()}] ERROR: ${n}`,t.appendChild(o),t.appendChild(document.createTextNode(`
`)),t.scrollTop=t.scrollHeight}function et(e){document.querySelectorAll("button").forEach(t=>{t.disabled=e})}async function tt(e){return new Uint8Array(await e.arrayBuffer())}function $n(e,t){const n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),URL.revokeObjectURL(n.href),n.remove()}async function On(e,t,n){const{n:o,k:r}=n,s=o-r;if(r<2||o<=r)throw new Error("Invalid RS parameters: require 2 <= k < n");if(s%2!==0)throw new Error("n-k must be even");const a=new DataView(e.buffer,e.byteOffset);let c=0;const u=e.subarray(c,c+G.length);if(c+=G.length,new TextDecoder().decode(u)!==new TextDecoder().decode(G))throw new Error("Not a .qenc");const d=a.getUint32(c,!1);c+=4;const i=e.subarray(c,c+d);c+=d;const m=e.subarray(c,c+12);c+=12;const b=e.subarray(c,c+16);c+=16;const h=a.getUint16(c,!1);c+=2;const S=e.subarray(c,c+h);c+=h;const U=e.subarray(c),v=JSON.parse(new TextDecoder().decode(S)),y=v.domainStrings||v.domain||{},p=v.originalLength||void 0,E=await z(e.subarray(0,c)),B=await z(e),l=r+s/2;if(l>o)throw new Error("Invalid threshold computed");const f=await(await Lt(async()=>{const{split:O}=await import("./index-Dc-5h1cZ.js");return{split:O}},[])).split(t,o,l),w=Array.from({length:o},()=>[]),k=v.chunkSize||te,A=v.aead_mode==="per-chunk-aead"||v.aead_mode==="per-chunk",K=A?v.chunkCount||Math.ceil(p/k):1;let x=0,T=0;for(let O=0;O<K;O++){let J;if(A){const M=Math.min(k,p-O*k)+16;J=U.subarray(x,x+M),x+=M}else J=U;const oe=Math.floor(256/o)*o;if(oe===0)throw new Error("RS parameters too large");const ee=oe*r/o,C=Math.ceil(J.length/ee)*ee;let $=J;if(C>J.length){const g=new Uint8Array(C);g.set(J),$=g}const L=s/2,I=window.erasure.split($,r,L);for(let g=0;g<I.length;g++){const M=I[g],D=await Me(M);console.log(`CREATION: chunk[${O}] fragment[${g}] length=${M.length} sha256=${D}`),console.log(` -> will write to shardIndex=${g} (expect file name contains idx=${g+1})`)}if(O===0&&await Bn($,r,s),I.length!==o)throw new Error("RS split returned unexpected number of fragments");O===0&&(T=I[0].length);for(let g=0;g<I.length;g++){const M=I[g],D=new Uint8Array(4);new DataView(D.buffer).setUint32(0,M.length,!1),w[g].push(D,M)}}const H=new Date().toISOString(),R={containerId:E,alg:{KEM:"ML-KEM-1024",KDF:"KMAC256",AEAD:"AES-256-GCM",RS:"ErasureCodes",fmt:"QVqcont-1"},aead_mode:A?"per-chunk":"single-container",iv_strategy:v.iv_strategy,n:o,k:r,m:s,t:l,chunkSize:k,chunkCount:K,containerHash:B,encapBlobHash:await z(i),privateKeyHash:await z(t),originalLength:p,ciphertextLength:U.length,domainStrings:{kdf:y.kdf||"quantum-vault:kdf:v1",iv:y.iv||"quantum-vault:iv:v1"},fragmentFormat:"len32-prefixed",perFragmentSize:T,timestamp:H},_=new TextEncoder().encode(JSON.stringify(R)),V=new Uint8Array(2);new DataView(V.buffer).setUint16(0,_.length,!1);const P=new Uint8Array(4);new DataView(P.buffer).setUint32(0,i.length,!1);const X=new TextEncoder().encode("QVC1"),j=[];for(let O=0;O<o;O++){const J=new Blob(w[O]),oe=new Uint8Array(await J.arrayBuffer()),ee=new Uint8Array(2);new DataView(ee.buffer).setUint16(0,S.length,!1);const C=new Uint8Array(X.length+2+_.length+4+i.length+12+16+2+S.length+2+2+f[O].length);let $=0;C.set(X,$),$+=X.length,C.set(V,$),$+=2,C.set(_,$),$+=_.length,C.set(P,$),$+=4,C.set(i,$),$+=i.length,C.set(m,$),$+=12,C.set(b,$),$+=16,C.set(ee,$),$+=2,C.set(S,$),$+=S.length;const L=new Uint8Array(2);new DataView(L.buffer).setUint16(0,O,!1),C.set(L,$),$+=2;const I=new Uint8Array(2);new DataView(I.buffer).setUint16(0,f[O].length,!1),C.set(I,$),$+=2,C.set(f[O],$);const g=new Blob([C,oe],{type:"application/octet-stream"});j.push({blob:g,index:O})}return j}function Tn(){const e=document.getElementById("qencForQcontInput"),t=document.getElementById("privKeyForQcontInput"),n=document.getElementById("rsN"),o=document.getElementById("rsK");document.getElementById("buildQcontBtn")?.addEventListener("click",async()=>{if(!e?.files?.[0]){Ie("Select .qenc");return}if(!t?.files?.[0]){Ie("Select private .qkey to split");return}const s=t.files[0];if(s.size!==3168){Ie(`Private .qkey must be exactly 3168 bytes (got ${s.size} B)`);return}et(!0);try{const a=await tt(e.files[0]),c=await tt(t.files[0]),u=parseInt(n.value,10),d=parseInt(o.value,10);if(Number.isNaN(u)||Number.isNaN(d))throw new Error("Invalid parameters");if(d<2||u<=d)throw new Error("Require 2 <= k < n");if((u-d)%2!==0)throw new Error("(n - k) must be even");if(!Kn(u,d))return;const i=d+(u-d)/2;Ne(`Building .qcont shards with n=${u}, k=${d}, m=${u-d} (t=${i}), chunkSize=8 MiB ...`);const m=await On(a,c,{n:u,k:d}),b=e.files[0].name.replace(/\.qenc$/i,"");m.forEach(({blob:h,index:S})=>{const U=`${b}.part${S+1}-of-${m.length}.qcont`;$n(h,U),Ne(`Saved ${U} (${h.size} B)`)}),Ne(".qcont shards built. Distribute files across storage providers.")}catch(a){Ie(a)}finally{et(!1)}})}async function Nn(e){const t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(n=>n.toString(16).padStart(2,"0")).join("")}function we(e){const t=document.getElementById("log");t&&(t.textContent+=`[${new Date().toLocaleTimeString()}] ${e}
`,t.scrollTop=t.scrollHeight)}function be(e){const t=document.getElementById("log");if(!t)return;const n=e&&e.message?e.message:typeof e=="string"?e:String(e),o=document.createElement("span");o.className="error",o.textContent=`[${new Date().toLocaleTimeString()}] ERROR: ${n}`,t.appendChild(o),t.appendChild(document.createTextNode(`
`)),t.scrollTop=t.scrollHeight}function nt(e){document.querySelectorAll("button").forEach(t=>{t.disabled=e})}async function Cn(e){return new Uint8Array(await e.arrayBuffer())}function ot(e,t){const n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),URL.revokeObjectURL(n.href),n.remove()}function Mn(){const e=document.getElementById("qcontShardsInput");document.getElementById("restoreQcontBtn")?.addEventListener("click",async()=>{const n=e?.files;if(!n?.length){be("Select .qcont shards");return}if(n.length<2){be("Select at least two .qcont shards");return}const o=n[0].size;for(let r=1;r<n.length;r++)if(n[r].size!==o){be("All selected .qcont shards must have the same file size.");return}nt(!0);try{const s=(await Promise.all([...n].map(Cn))).map(L=>{const I=new DataView(L.buffer,L.byteOffset);let g=0;const M=new TextDecoder().decode(L.subarray(g,g+4));if(g+=4,M!=="QVC1")throw new Error("Invalid .qcont magic");const D=I.getUint16(g,!1);g+=2;const re=JSON.parse(new TextDecoder().decode(L.subarray(g,g+D)));g+=D;const Q=I.getUint32(g,!1);g+=4;const N=L.subarray(g,g+Q);g+=Q;const he=L.subarray(g,g+12);g+=12;const $e=L.subarray(g,g+16);g+=16;const W=I.getUint16(g,!1);g+=2;const se=L.subarray(g,g+W);g+=W;const pe=I.getUint16(g,!1);g+=2;const de=I.getUint16(g,!1);g+=2;const Re=L.subarray(g,g+de);g+=de;const Z=L.subarray(g);console.log(`RESTORE: shardIndex=${pe} totalFragBytes=${Z.length}`);const fe=re.perFragmentSize;if(fe&&Z.length>=4+fe){const ce=new DataView(Z.buffer,Z.byteOffset).getUint32(0,!1),ae=4,St=ae+Math.min(ce,fe),_e=Z.subarray(ae,St);Nn(_e).then(Ut=>console.log(`  -> firstFrag len=${_e.length} sha256=${Ut}`))}return{metaJSON:re,encapsulatedKey:N,iv:he,salt:$e,qencMetaBytes:se,shardIndex:pe,share:Re,fragments:Z}}),a=new Map;for(const L of s){const I=L.metaJSON.containerId;a.has(I)||a.set(I,[]),a.get(I).push(L)}const[c,u]=[...a.entries()][0],{n:d,k:i,m,t:b,ciphertextLength:h,chunkSize:S,chunkCount:U,containerHash:v,privateKeyHash:y,aead_mode:p,perFragmentSize:E}=u[0].metaJSON,B=p==="per-chunk"||p==="per-chunk-aead";for(const L of u){const I=L.metaJSON;if(I.containerId!==c||I.n!==d||I.k!==i||I.m!==m||I.t!==b)throw new Error("Shard parameter mismatch (containerId/n/k/m/t)")}if(await z(u[0].encapsulatedKey)!==u[0].metaJSON.encapBlobHash)throw new Error("encapBlobHash mismatch");if(u.length<b)throw new Error(`Need at least ${b} shards, got ${u.length}`);const w=u.slice().sort((L,I)=>L.shardIndex-I.shardIndex).slice(0,b).map(L=>L.share),k=await(await Lt(async()=>{const{combine:L}=await import("./index-Dc-5h1cZ.js");return{combine:L}},[])).combine(w),K=Math.floor(256/d)*d*i/d,x=h,T=U,H=[],R=new Array(d).fill(0);for(let L=0;L<T;L++){const I=Math.min(S,u[0].metaJSON.originalLength-L*S),g=B?I+16:x,D=Math.floor(256/d)*d*i/d,re=D/i,N=Math.ceil(g/D)*re,he=new Array(d);for(let W=0;W<d;W++){const se=u.find(ae=>ae.shardIndex===W)?.fragments;if(!se){he[W]=new Uint8Array(N);continue}const pe=se.length,de=R[W];if(de+4>pe)throw new Error("Fragment stream underflow");const Z=new DataView(se.buffer,se.byteOffset+de).getUint32(0,!1),fe=de+4,Le=fe+Z;if(Le>pe)throw new Error("Fragment length overflow");let ce=se.subarray(fe,Le);if(Z<N){const ae=new Uint8Array(N);ae.set(ce),ce=ae}else Z>N&&(ce=ce.subarray(0,N));he[W]=ce,R[W]=Le}const $e=window.erasure.recombine(he,g,i,m/2);if(H.push($e),!B)break}const _=B?(()=>{const L=H.reduce((M,D)=>M+D.length,0),I=new Uint8Array(L);let g=0;for(const M of H)I.set(M,g),g+=M.length;return I})():H[0],V=(()=>{const{encapsulatedKey:L,iv:I,salt:g,qencMetaBytes:M}=u[0],D=new Uint8Array(4);new DataView(D.buffer).setUint32(0,L.length,!1);const re=new Uint8Array(2);new DataView(re.buffer).setUint16(0,M.length,!1);const Q=new Uint8Array(G.length+4+L.length+12+16+2+M.length);let N=0;return Q.set(G,N),N+=G.length,Q.set(D,N),N+=4,Q.set(L,N),N+=L.length,Q.set(I,N),N+=12,Q.set(g,N),N+=16,Q.set(re,N),N+=2,Q.set(M,N),Q})(),P=new Uint8Array(V.length+_.length);P.set(V,0),P.set(_,V.length);const X=await z(P),j=await z(k),O=X===v,J=j===y;we(`Recovered .qenc SHA3-512=${X} (expected ${v})`),we(O?"Hashes match! File integrity verified.":"WARNING: .qenc hash mismatch!"),we(`Recovered .qkey SHA3-512=${j} (expected ${y})`),we(J?"Hashes match! File integrity verified.":"WARNING: .qkey hash mismatch!");const oe=new Blob([P],{type:"application/octet-stream"}),ee=new Blob([k],{type:"application/octet-stream"}),C=`${c}.recovered.qenc`,$=`${c}.recovered.secretKey.qkey`;if(O&&J)ot(oe,C),ot(ee,$),we("✅ Recovered .qenc and .qkey from .qcont shards.");else{be("Hash mismatch detected. Automatic download is blocked. Review and download manually if needed.");const L=document.createElement("a");L.href=URL.createObjectURL(oe),L.download=C,L.textContent=`Manual download: ${C}`,L.target="_blank",L.rel="noopener";const I=document.createElement("a");I.href=URL.createObjectURL(ee),I.download=$,I.textContent=`Manual download: ${$}`,I.target="_blank",I.rel="noopener";const g=document.getElementById("log");g.appendChild(L),g.appendChild(document.createTextNode(`
`)),g.appendChild(I),g.appendChild(document.createTextNode(`
`))}}catch(r){be(r)}finally{nt(!1)}})}Un();Tn();Mn();
