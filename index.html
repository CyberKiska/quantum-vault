<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quantum Vault</title>
  <script type="module" crossorigin src="/quantum-vault/assets/index-CE1aLO3T.js"></script>
  <link rel="stylesheet" crossorigin href="/quantum-vault/assets/index-Chhtuloh.css">
</head>
<body>
  <div class="app-wrapper">
    <!-- Header -->
    <header class="app-header">
      <div class="brand">
        <span class="logo-icon">üõ°Ô∏è</span>
        <div class="brand-text">
          <h1>Quantum Vault</h1>
          <span class="version-badge">v1.4.0</span>
        </div>
      </div>
      <div class="header-controls">
        <div class="mode-switch-container">
          <span class="mode-label">Lite</span>
          <label class="toggle-switch">
            <input type="checkbox" id="modeToggle">
            <span class="slider"></span>
          </label>
          <span class="mode-label">Pro</span>
        </div>
      </div>
    </header>

    <!-- Main Content Stage -->
    <main class="main-stage">
      
      <!-- LITE MODE -->
      <section id="liteMode" class="mode-section active">
        <div class="mode-nav">
          <button id="liteTabProtect" class="nav-tab active">Encrypt & Split</button>
          <button id="liteTabRestore" class="nav-tab">Recover</button>
        </div>

        <!-- Lite View: Protect -->
        <div id="liteViewProtect" class="view-container active">
          
          <div class="visual-pipeline-container">
             <!-- Visual Pipeline Placeholder -->
             <div class="pipeline-step step-file">
               <span class="icon">üìÑ</span>
               <span class="label">File</span>
             </div>
             <div class="pipeline-arrow">‚Üí</div>
             <div class="pipeline-step step-lock">
               <span class="icon">üîí</span>
               <span class="label">Encrypt</span>
             </div>
             <div class="pipeline-arrow">‚Üí</div>
             <div class="pipeline-step step-split">
               <span class="icon">üß©</span>
               <span class="label">Split</span>
             </div>
          </div>

          <div class="action-card">
            <div class="dropzone-area" id="liteDropzone">
              <h3>Select files to protect</h3>
              <p>Drag & drop or click to select</p>
              <input type="file" id="liteFilesInput" multiple>
              <div id="liteFilesList" class="files-list" style="display: none;"></div>
            </div>
            
            <div class="config-area">
              <div class="key-status-row">
                 <div id="keyStatus" class="status-badge">
                   <span class="status-icon">üîë</span>
                   <span class="status-text">Generating keys...</span>
                 </div>
                 <button id="liteDownloadKeysBtn" class="secondary-btn small-btn" style="display: none;">
                   üì• Backup Keys
                 </button>
              </div>

              <div class="config-controls">
                <div class="input-group">
                  <label>Total shards (n) <span class="info" title="Total number of shard files to create">‚Ñπ</span></label>
                  <input type="number" id="liteN" value="5" min="5" max="25">
                </div>
                <div class="input-group">
                  <label>Approximate recovery threshold (%) <span class="info" title="Approximate percentage of shards needed for recovery">‚Ñπ</span></label>
                  <input type="number" id="liteThreshold" value="60" min="50" max="90" step="5">
                </div>
              </div>
              <div class="threshold-display">
                <span id="thresholdText" class="value-display">Requested 60% -> Achievable 80% (>=4/5 shards)</span>
                <span id="thresholdDelta" class="threshold-delta"></span>
                <small id="thresholdHint" class="info-text">Discrete by RS/SSS constraints.</small>
              </div>
            </div>

            <button id="liteCreateShardsBtn" class="primary-btn big-btn" disabled>üõ°Ô∏è Encrypt & Create Shards</button>
          </div>
        </div>

        <!-- Lite View: Restore -->
        <div id="liteViewRestore" class="view-container" style="display: none;">
           <div class="visual-pipeline-container">
             <div class="pipeline-step step-split">
               <span class="icon">üß©</span>
               <span class="label">Shards</span>
             </div>
             <div class="pipeline-arrow">‚Üí</div>
             <div class="pipeline-step step-combine">
               <span class="icon">‚ú®</span>
               <span class="label">Combine</span>
             </div>
             <div class="pipeline-arrow">‚Üí</div>
             <div class="pipeline-step step-file">
               <span class="icon">üìÑ</span>
               <span class="label">File</span>
             </div>
          </div>

          <div class="action-card">
            <div class="dropzone-area" id="liteShardsDropzone">
              <h3>Select Shards to Restore</h3>
              <p>Select multiple .qcont files</p>
              <input type="file" id="liteShardsInput" accept=".qcont" multiple>
            </div>
            <div id="shardsStatus" class="shards-status" style="display: none;">
              <span id="shardsStatusText">0 shards selected</span>
            </div>
            <button id="liteRestoreBtn" class="primary-btn big-btn" disabled>‚ôªÔ∏è Restore Original Files</button>
          </div>
        </div>
      </section>

      <!-- PRO MODE -->
      <section id="proMode" class="mode-section" style="display: none;">
        <div class="mode-nav">
          <button id="proTabIdentity" class="nav-tab active"><span class="step-num">1</span> Key Management</button>
          <button id="proTabEncryption" class="nav-tab"><span class="step-num">2</span> Encryption</button>
          <button id="proTabDistribution" class="nav-tab"><span class="step-num">3</span> Split (Sharding)</button>
          <button id="proTabRestore" class="nav-tab">Reconstruct</button>
        </div>

        <!-- Pro View: Identity -->
        <div id="proViewIdentity" class="view-container active">
          <div class="panel">
            <h3>Key Generation</h3>
            <div class="control-group">
               <button id="genKeyBtn" class="secondary-btn">üîë Generate New Key Pair</button>
               <button id="advancedEntropyBtn" class="secondary-btn">üé≤ Collect Advanced Entropy</button>
            </div>
            
            <div id="entropyStatus" class="entropy-status" style="display: none;">
              <span id="entropyText">Collecting entropy...</span>
              <div class="progress-bar-bg"><div id="entropyBar" class="progress-bar-fill" style="width: 0%"></div></div>
              <small class="entropy-info">Privacy-preserving collection: mouse/keyboard timing, window resizing. Local processing only.</small>
            </div>
          </div>

          <div class="panel">
            <h3>Active Keys</h3>
            <div class="control-group">
              <label>Secret Key (.qkey) <span class="info" title="ML-KEM secret key (3168 bytes), required for decryption and shard splitting.">‚Ñπ</span> <input type="file" id="privKeyInput" accept=".qkey"></label>
              <label>Public Key (.qkey) <span class="info" title="ML-KEM public key (1568 bytes), required for encryption.">‚Ñπ</span> <input type="file" id="pubKeyInput" accept=".qkey"></label>
            </div>
          </div>
        </div>

        <!-- Pro View: Encryption -->
        <div id="proViewEncryption" class="view-container" style="display: none;">
          <div class="panel">
            <h3>File Operations</h3>
            <div class="control-group">
              <label>Input Files <input type="file" id="dataFileInput" multiple></label>
              <div id="proFilesList" class="files-list" style="display: none;"></div>
            </div>
            <div id="proEncStrategyGroup" class="strategy-group" style="display: none;">
              <span class="strategy-title">Container strategy</span>
              <label class="strategy-option">
                <input type="radio" id="proEncStrategyPack" name="proEncStrategy" value="pack" checked>
                Pack files into one container
              </label>
              <label class="strategy-option">
                <input type="radio" id="proEncStrategyPerFile" name="proEncStrategy" value="per-file">
                One container per file
              </label>
            </div>
            <div id="proEncryptionWarning" class="operation-warning">
              <small>Load keys in tab "1. Key Management": public key for encryption, private key for decryption.</small>
            </div>
            <div class="button-row">
              <button id="encBtn" class="action-btn">üîí Encrypt (.qenc)</button>
              <button id="decBtn" class="action-btn">üîì Decrypt (File)</button>
            </div>
          </div>
        </div>

        <!-- Pro View: Distribution -->
        <div id="proViewDistribution" class="view-container" style="display: none;">
           <div class="panel">
            <h3>Sharding Configuration (SSS + RS)</h3>
            <div class="control-group">
              <label>Input .qenc <input type="file" id="qencForQcontInput" accept=".qenc"></label>
              <label>Input Private .qkey (to split) <input type="file" id="privKeyForQcontInput" accept=".qkey"></label>
            </div>

            <div class="rs-controls">
                <label>Total Shards (n) <input type="number" id="rsN" value="5" min="3"></label>
                <label>Data Shards (k) <input type="number" id="rsK" value="3" min="2"></label>
            </div>
            <div style="background: var(--bg-input); padding: var(--space-sm); border-radius: var(--radius-sm); margin-top: var(--space-sm);">
                <small id="rsText" class="info-text rs-summary">Params info...</small>
                <div id="rsConstraints" class="rs-constraints">
                  <div id="rsRuleN" class="constraint-item">n &gt;= 5</div>
                  <div id="rsRuleRange" class="constraint-item">2 &lt;= k &lt; n</div>
                  <div id="rsRuleEven" class="constraint-item">(n - k) must be even</div>
                </div>
            </div>
            
            <!-- RS Viz (Existing) -->
            <div id="rsViz" class="rs-viz-bar">
                <div class="rs-bar">
                <span class="rs-seg data" id="rsSegData"><span class="seg-label" id="rsDataLabel"></span></span>
                <span class="rs-seg parity" id="rsSegParity"><span class="seg-label" id="rsParityLabel"></span></span>
                <span class="rs-marker" id="rsMarker"></span>
                <span class="rs-marker-label" id="rsMarkerLabel"></span>
              </div>
              <div class="rs-ticks" id="rsTicks"></div>
              <div class="rs-legend">
                <span class="swatch data"></span> Data k
                <span class="swatch parity"></span> Parity m
                <span class="swatch marker"></span> Threshold t
              </div>
              <details class="tip">
                  <summary>Configuration Tips</summary>
                  <div>
                  More availability = reduce k or t;<br />
                  More confidentiality = increase m.<br />
                  If someone controls t shards they can decrypt; with fewer than t shards they cannot.<br />
                  m ‚Äî in the context of RS is the number of redundant parity shards.<br />
                  t ‚Äî in the context of SSS, this is the threshold: the minimum number of Shamir shards required to recover the secret (private key).<br />
                  </div>
                </details>
            </div>

            <button id="buildQcontBtn" class="action-btn" disabled>üß© Build Shards</button>
           </div>
        </div>

        <!-- Pro View: Restore (New) -->
        <div id="proViewRestore" class="view-container" style="display: none;">
           <div class="panel">
            <h3>Reconstruct Container</h3>
            <div class="control-group">
               <label>Input Shards <input type="file" id="qcontShardsInput" accept=".qcont" multiple></label>
            </div>
            <div id="proShardsStatus" class="shards-status" style="display: none;">
              <span id="proShardsStatusText">0 shards selected</span>
            </div>
            <button id="restoreQcontBtn" class="action-btn" disabled>‚ôªÔ∏è Restore</button>
           </div>
        </div>
      </section>

    </main>

    <footer class="app-footer">
      <div class="log-container" id="logContainer">
        <div class="log-header">
          <h3>Operations Log</h3>
          <button id="logToggleBtn" class="secondary-btn small-btn" type="button">Show Log</button>
        </div>
        <pre id="log"></pre>
      </div>
    </footer>
  </div>

  <script src="/quantum-vault/third-party/erasure.js"></script>
</body>
</html>
